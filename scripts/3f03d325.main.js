BT={};var DataChannel=function(){var a,b="ws://ws.blockchain.info:8335/inv",c=function(){return a=new WebSocket(b),{ws:a,start:e}},d=function(b){var c=new CustomEvent("sentmessage");c.data=b,a.dispatchEvent(c)},e=function(){f({op:"unconfirmed_sub"})},f=function(b){b=JSON.stringify(b),d(b),a.send(b)};return c()},IpDecoder=function(){var a,b="http://freegeoip.net/json/",c=[],d={},e=function(){return a=setInterval(h,1e3),{queue:c}},f=function(){var a=JSON.parse(this.responseText);g(a),a.cached=!0,d[a.ip]=a},g=function(a){var b=new CustomEvent("geoip");b.data=a,document.dispatchEvent(b)},h=function(){var a,e;a=c.pop(),a&&"127.0.0.1"!==a&&(d[a]&&g(d[a]),e=new XMLHttpRequest,e.onload=f,e.open("get",b+a,!0),e.send())};return e()},LiveMap=function(){var a=L.map("map").setView([42.617791,-15.306702],3),b=L.icon({iconUrl:"images/marker-icon.png",iconSize:[10,10],iconAnchor:[5,5]}),c=function(){d(),e(),document.addEventListener("geoip",f)},d=function(){var b=($(window).height(),$(window).height());$("#map").css("height",b),a.invalidateSize()},e=function(){L.tileLayer("http://{s}.tile.cloudmade.com/2c83ee06868f422f8163dfae1d636cf0/118040/256/{z}/{x}/{y}.png",{maxZoom:3,minZoom:2}).addTo(a)},f=function(c){{var d=c.data;L.marker([d.latitude,d.longitude],{icon:b,bounceOnAdd:!0,bounceOnAddOptions:{duration:500,height:100},bounceOnAddCallback:function(){}}).addTo(a)}};return c()},LetterUpdater=function(){var a,b=$(window).width(),c=$(window).height(),d=["welcome to the awsomeness","explore about bitcoins","lalala"],e=function(){f(),g(d[0].split("")),setInterval(function(){g(d[Math.round(2*Math.random())].split(""))},1500)},f=function(){a=d3.select("#js-messageArea").append("svg").attr("width",b-70).attr("height",c-130).append("g").attr("transform","translate(32,"+c/2+")")},g=function(b){var c=[],d=[],e=a.selectAll("text").data(b,function(a){return this.dx?(d.push(a),a+d.count(a)):(c.push(a),a+c.count(a))});e.attr("class","update").transition().duration(750).attr("x",function(a,b){return 32*b}),e.enter().append("text").attr("class","enter").attr("dy",".35em").attr("y",-60).attr("x",function(a,b){return 32*b}).style("fill-opacity",1e-6).text(function(a){return a}).transition().duration(750).attr("y",0).style("fill-opacity",1),e.exit().transition().duration(750).attr("y",60).style("fill-opacity",1e-6).remove()};return e()};$(document).foundation(),blockChain=new DataChannel,geoIP=new IpDecoder,blockChain.ws.addEventListener("message",function(a){var b,c=JSON.parse(a.data);c.x&&c.x.relayed_by&&c.x.out&&(b=c.x.relayed_by,geoIP.queue.push(b))}),setTimeout(blockChain.start,3e3),$(".js-contentRegion").css({height:$(window).height()+"px"}),$(window).resize(function(){$(".js-contentRegion").css({height:$(window).height()+"px"})});var letterUpdater=new LetterUpdater,map=new LiveMap;