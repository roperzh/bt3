BT={};var DataChannel=function(){var a,b="ws://ws.blockchain.info:8335/inv",c=function(){return a=new WebSocket(b),{ws:a,start:e}},d=function(b){var c=new CustomEvent("sentmessage");c.data=b,a.dispatchEvent(c)},e=function(){f({op:"unconfirmed_sub"})},f=function(b){b=JSON.stringify(b),d(b),a.send(b)};return c()},IpDecoder=function(){var a,b="http://freegeoip.net/json/",c=[],d={},e=function(){return a=setInterval(h,1e3),{queue:c}},f=function(){var a=JSON.parse(this.responseText);g(a),a.cached=!0,d[a.ip]=a},g=function(a){var b=new CustomEvent("geoip");b.data=a,document.dispatchEvent(b)},h=function(){var a,e;a=c.pop(),a&&"127.0.0.1"!==a&&(d[a]&&g(d[a]),e=new XMLHttpRequest,e.onload=f,e.open("get",b+a,!0),e.send())};return e()},LiveMap=function(){var a=L.map("map").setView([42.617791,-15.306702],3),b=L.AwesomeMarkers.icon({icon:"bitcoin",markerColor:"red"}),c=function(){d(),e(),document.addEventListener("geoip",f)},d=function(){var b=($(window).height(),$(window).height());$("#map").css("height",b),a.invalidateSize()},e=function(){var b=L.tileLayer("http://{s}.tile.cloudmade.com/2c83ee06868f422f8163dfae1d636cf0/997/256/{z}/{x}/{y}.png",{maxZoom:10,minZoom:2});b.on("click",function(a,b,c){console.log(a,b,c)}),b.addTo(a)},f=function(c){{var d=c.data;L.marker([d.latitude,d.longitude],{icon:b,bounceOnAdd:!0,bounceOnAddOptions:{duration:500,height:100},bounceOnAddCallback:function(){}}).addTo(a)}};return c()},LetterUpdater=function(){var a,b=$(window).width(),c=$(window).height(),d=0,e=["Think about...","real time visualizations...","open data...","D3 + Modular JS"],f=function(){h(),i(e[0].split("")),setInterval(function(){i(g().split(""))},2500)},g=function(){d++;var a=e[d];return a?a:(d=0,e[0])},h=function(){a=d3.select("#js-messageArea").append("svg").attr("width",b-70).attr("height",c-130).append("g").attr("transform","translate("+b/4+","+c/2.5+")")},i=function(b){var c=[],d=[],e=a.selectAll("text").data(b,function(a){return this.dx?(d.push(a),a+d.count(a)):(c.push(a),a+c.count(a))});e.attr("class","update").transition().duration(750).attr("x",function(a,b){return 40*b}),e.enter().append("text").attr("class","enter").attr("dy",".35em").attr("y",-60).attr("x",function(a,b){return 40*b}).style("fill-opacity",1e-6).text(function(a){return a}).transition().duration(750).attr("y",0).style("fill-opacity",1),e.exit().transition().duration(750).attr("y",60).style("fill-opacity",1e-6).remove()};return f()},Calculator=function(a,b,c){var d=this;$("#js-difficulty").html(a),$(".slider").noUiSlider({range:[0,4500],start:400,handles:1,connect:"lower",serialization:{resolution:1},slide:function(){var a=f(this.val());d.calc(a)}});var e=function(){d.calc(400)};this.calc=function(d){$("#js-currentHashRate").html(d),$("#nmcblocktime").text(h(d,a)),c.dispatchEvent({type:"rate",btcPerDay:i(d,a,1),usdPerDay:j(d,a,b,1),cost:g(d)})};var f=function(a){return 1500>a?a:3e3>a?6*a:20*a},g=function(c){return 1/j(c,a,b,1)*2.64},h=function(a,b){var c=4294967296*b/(1e6*a);return k(c)},i=function(a,b,c){var d=4294967296*b/(1e6*a),e=50/(d/(24*c)/60/60);return e},j=function(a,b,c,d){var e=i(a,b,d),f=e*c;return f},k=function(a){a=Number(a);var b=Math.floor(a/3600/24),c=Math.floor(a/3600)-24*Math.floor(a/3600/24),d=Math.floor(a%3600/60),e=Math.floor(a%3600%60),f="";return b>0&&(f+=(b>1?b+" days":b+" day")+", "),c>0&&(f+=(c>1?c+" hours":c+" hour")+", "),d>0&&(f+=(d>1?d+" minutes":d+" minute")+", "),e>0&&(f+=(e>1?e+" seconds":e+" second")+", "),", "===f.substring(f.length-2)&&(f=f.substring(0,f.length-2)),f};return e()},StatisticsManager=function(a){var b,c,d=$(window).width()-150,e=$(window).height(),f=Math.floor(d/70),g=["home","lamp","mobile","desktop"],h=0,i={home:18e3,lamp:1440,desktop:6e3,mobile:72},j=function(a){"next"===a?h++:h--;var b=g[h];return b?b:(h=0,g[0])},k=function(){n(),o(),l("home"),c=setInterval(function(){var a=j("next");l(a)},5e3)},l=function(b){var c=Math.ceil(a/i[b])/1e3,d=c.toString().split(""),e=Number.range(0,c).every();r(d),s(e,m(b))},m=function(a){switch(a){case"home":return"";case"lamp":return"";case"mobile":return"";case"desktop":return""}},n=function(){b=d3.select(".test").append("svg").attr("width",d-70).attr("height",e-130).append("g").attr("transform","translate(32,"+e/2+")")},o=function(){var a=b.append("g").attr("class","buttonsGroup");a.append("text").attr("font-family","FontAwesome").text("").attr("x",function(){return d-200}).attr("y",200).attr("class","prevButton").on("click",p).on("mouseover",function(){$(this).attr("class","active")}).on("mouseout",function(){$(this).attr("class","prevButton")}),a.append("text").attr("font-family","FontAwesome").text("").attr("x",function(){return d-150}).attr("y",200).attr("class","nextButton").on("click",q).on("mouseover",function(){$(this).attr("class","active")}).on("mouseout",function(){$(this).attr("class","nextButton")})},p=function(){l(j("prev"))},q=function(){l(j("next"))},r=function(a){var c=b.selectAll(".number").data(a,function(a){return a});c.transition().duration(500).attr("x",function(a,b){return d-300+32*b}),c.enter().append("text").attr("x",function(a,b){return d-300+32*b}).attr("dy",".35em").attr("y",-60).attr("class","number").style("fill-opacity",1e-6).text(function(a){return a}).transition().duration(500).attr("y",0).style("fill-opacity",1),c.exit().transition().duration(500).attr("y",60).style("fill-opacity",1e-6).remove()},s=function(a,c){var d=b.selectAll(".fa-symbol").data(a,function(a){return a});d.attr("class","update fa-symbol").transition().duration(750).attr("x",function(a,b){return 50*(b-f*Math.floor(b/f))}).attr("font-family","FontAwesome").text(function(){return c}),d.enter().append("text").attr("class","enter fa-symbol").attr("dy",".35em").style("fill-opacity",1e-6).attr("x",0).transition().duration(750).text(function(){return c}).attr("y",function(a,b){return 60*Math.floor(b/f)}).style("fill-opacity",1),d.exit().transition().duration(750).attr("y",60).style("fill-opacity",1e-6).remove()};return k()},PieChart=function(a){var b,c=["ARS","AUD","BRL","CAD","CHF","CNY","CZK","DKK","EUR","GBP","HKD","ILS","INR","JPY","KRW","LTC","MXN","NMC","NOK","NZD","PLN","RUB","SEK","SGD","SLL","THB","USD","XRP","ZAR"],d=960,e=700,f=Math.min(d,e)/2,g=d3.scale.linear().range([0,2*Math.PI]),h=d3.scale.sqrt().range([0,f]),i=d3.scale.category50(),j=function(){k()},k=function(){function c(a){var b=d3.interpolate(g.domain(),[a.x,a.x+a.dx]),c=d3.interpolate(h.domain(),[a.y,1]),d=d3.interpolate(h.range(),[a.y?20:0,f]);return function(a,e){return e?function(){return k(a)}:function(e){return g.domain(b(e)),h.domain(c(e)).range(d(e)),k(a)}}}b=d3.select(a).append("svg").attr({width:d,height:e}).append("g").attr("transform","translate("+d/2+","+(e/2+10)+")");var j=d3.layout.partition().value(function(a){return a.score}),k=d3.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,g(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,g(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,h(a.y))}).outerRadius(function(a){return Math.max(0,h(a.y+a.dy))});d3.json("http://bt3api.herokuapp.com/ticker",function(a,f){function g(a){o.text(a.name?a.name:a.symbol)}function h(a){n.transition().duration(750).style("fill-opacity",function(b){return"flare"!==a.name||b.children?1:1e-6}).attrTween("d",c(a))}var m=l(f),n=b.selectAll("path").data(j.nodes(m)).enter().append("path").attr("d",k).style("fill",function(a){return i(a.children?a.name:a.symbol)}).style("fill-opacity",function(a){return a.children?1:1e-6}).attr("class",function(a){return a.children?"visible":"hidden"}).on("click",h).on("mouseenter",g),o=b.append("text").text("Click / hover").attr("x",d/-4).attr("y",e/-4)}),d3.select(self.frameElement).style("height",e+"px")},l=function(a){var b={name:"flare"},d=[];for(var e in c){var f=m(a,e);f.children=[],f.name=f.symbol;var g={name:c[e]};g.children=f,g.score=f.length,d.push(g)}return b.children=d,b},m=function(a,b){return a.filter(function(a){return a.score=2,a.currency===c[b]})};return j()},BulletChart=function(a){var b,c={top:5,right:40,bottom:20,left:120},d=500-c.left-c.right,e=60-c.top-c.bottom,f=d3.bullet().width(d).height(e),g=[{title:"Bit Coins",subtitle:"per day",ranges:[.01,.04,.06],measures:[.03],markers:[.05]},{title:"USD",subtitle:"per day",ranges:[5,20,50],measures:[8],markers:[40]},{title:"Energy",subtitle:"KW",ranges:[450,600,1e3],measures:[350],markers:[800]},{title:"Cost",subtitle:"USD",ranges:[10,30,50],measures:[10],markers:[45]}],h=function(a){b=d3.select("#js-bulletChart").selectAll("svg").data(a).enter().append("svg").attr("class","bullet").attr("width",d+c.left+c.right).attr("height",e+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")").call(f);var g=b.append("g").style("text-anchor","end").attr("transform","translate(-6,"+e/2+")");g.append("text").attr("class","title").text(function(a){return a.title}),g.append("text").attr("class","subtitle").attr("dy","1em").text(function(a){return a.subtitle})},i=function(b){switch(b.title){case"Bit Coins":b.measures=[a.data.btcPerDay];break;case"USD":b.measures=[a.data.usdPerDay];break;case"Cost":b.measures=[a.data.cost]}return b},j=function(){h(g),a.addEventListener("rate",function(c){a.data=c,b.datum(i).call(f.duration(200))})};return j()};App=function(){var a=this,b=($(window).width(),$(window).height()),c=function(){EventDispatcher.prototype.apply(App.prototype);new BulletChart(a),new Calculator(1789546951,836.936,a),new DataChannel,new IpDecoder,new LetterUpdater,new LiveMap,new StatisticsManager(223300861.7188927);$(document).foundation(),$(".js-contentRegion").css({height:b+"px"}),$(window).resize(function(){$(".js-contentRegion").css({height:b+"px"})}),$("[id*='Btn']").stop(!0).on("click",function(a){a.preventDefault(),$(this).scrolld()})};return c()},app=new App;