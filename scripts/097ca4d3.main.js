BT={};var DataChannel=function(){var a,b="ws://ws.blockchain.info:8335/inv",c=function(){return a=new WebSocket(b),{ws:a,start:e}},d=function(b){var c=new CustomEvent("sentmessage");c.data=b,a.dispatchEvent(c)},e=function(){f({op:"unconfirmed_sub"})},f=function(b){b=JSON.stringify(b),d(b),a.send(b)};return c()},IpDecoder=function(){var a,b="http://freegeoip.net/json/",c=[],d={},e=function(){return a=setInterval(h,1e3),{queue:c}},f=function(a){var a=JSON.parse(this.responseText);g(a),a.cached=!0,d[a.ip]=a},g=function(a){var b=new CustomEvent("geoip");b.data=a,document.dispatchEvent(b)},h=function(){var a,e;a=c.pop(),a&&"127.0.0.1"!==a&&(d[a]&&g(d[a]),e=new XMLHttpRequest,e.onload=f,e.open("get",b+a,!0),e.send())};return e()},LiveMap=function(){var a=L.map("map").setView([42.617791,-15.306702],3),b=L.icon({iconUrl:"images/marker-icon.png",iconSize:[10,10],iconAnchor:[5,5]}),c=function(){d(),e(),document.addEventListener("geoip",f)},d=function(){var b=$(window).height(),c=b-250,d=b-c;$("#map").css("height",c),$(".boundaries").css("height",d),a.invalidateSize()},e=function(){L.tileLayer("http://{s}.tile.cloudmade.com/2c83ee06868f422f8163dfae1d636cf0/118040/256/{z}/{x}/{y}.png",{maxZoom:3,minZoom:2}).addTo(a)},f=function(c){{var d=c.data;L.marker([d.latitude,d.longitude],{icon:b,bounceOnAdd:!0,bounceOnAddOptions:{duration:500,height:100},bounceOnAddCallback:function(){}}).addTo(a)}};return c()};blockChain=new DataChannel,geoIP=new IpDecoder,blockChain.ws.addEventListener("message",function(a){var b,c=JSON.parse(a.data);c.x&&c.x.relayed_by&&c.x.out&&(b=c.x.relayed_by,geoIP.queue.push(b))}),setTimeout(blockChain.start,3e3);